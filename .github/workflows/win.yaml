name: MacOS 26 Test Lab

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022
    timeout-minutes: 360   # Max 6 gi·ªù

    steps:
    - name: Enable RDP
      run: |
        # B·∫≠t RDP
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Get-Service -Name TermService | Set-Service -StartupType Automatic
        Start-Service -Name TermService

    - name: Create user "blender"
      run: |
        net user blender 123456Hi /add
        net localgroup administrators blender /add
        Write-Host "‚úÖ User 'blender' created with password '123456Hi'"

    - name: Optimize VPS
      run: |
        # Ultimate Performance
        powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61
        powercfg -setactive e9a42b02-d5df-448d-aa00-03f14749eb61
        # Disable useless services
        Stop-Service wuauserv; Set-Service wuauserv -StartupType Disabled
        Stop-Service Spooler; Set-Service Spooler -StartupType Disabled
        sc config DiagTrack start= disabled
        sc config SysMain start= disabled
        Write-Host "‚ö° Optimization applied."

    - name: Start SSH Tunnel with Pinggy
      shell: bash
      run: |
        echo "‚è≥ Starting Pinggy tunnel..."
        ssh -o StrictHostKeyChecking=no -p 443 -R0:127.0.0.1:3389 qr@free.pinggy.io &

        sleep 15
        echo ""
        echo "==========================="
        echo "    üíª DUO VPS - 6Hour ‚è≥"
        echo " BY: üêâ SHANGHAI & NULLTESTFUN1 ‚ö°"
        echo "==========================="
        echo " üåê HOST/IP : (xem log Pinggy ·ªü tr√™n)"
        echo " üë§ USER    : blender"
        echo " üîë PASS    : 123456Hi"
        echo " ‚è±Ô∏è Max TIME: 6 Hour"
        echo "==========================="
        echo "‚úÖ Started at $(date +%H:%M:%S)"
        echo ""

    - name: Keep Alive & Anti-ban
      shell: bash
      run: |
        echo "‚è≥ KeepAlive running..."
        while true; do
          RAND=$((1000 + RANDOM % 9000))
          echo "üîπ Alive ping at $(date +%H:%M:%S) :: $RAND"
          sleep 300
        done
