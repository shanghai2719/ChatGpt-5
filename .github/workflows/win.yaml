name: Ubuntu 25.3.1 alpha

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
    - name: Setup system
      run: |
        sudo apt update -y
        sudo apt upgrade -y

    - name: Create user blender
      run: |
        sudo useradd -m -s /bin/bash blender
        echo "blender:123456Hi" | sudo chpasswd
        sudo usermod -aG sudo blender
        echo "✅ User blender created with sudo privileges"

    - name: Install XFCE4 + xRDP + SSH
      run: |
        sudo DEBIAN_FRONTEND=noninteractive apt install -y xfce4 xfce4-goodies xrdp openssh-server
        sudo systemctl enable xrdp
        sudo systemctl start xrdp
        sudo systemctl enable ssh
        sudo systemctl start ssh
        # Cho phép password login qua SSH
        sudo sed -i 's/^#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo sed -i 's/^PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo systemctl restart ssh
        echo "✅ XFCE4 + RDP + SSH installed & running"

    - name: Start Pinggy Tunnel (RDP + SSH)
      run: |
        nohup ssh -o StrictHostKeyChecking=no -p 443 -R0:127.0.0.1:3389 qr@free.pinggy.io > /dev/null 2>&1 &
        nohup ssh -o StrictHostKeyChecking=no -p 443 -R0:127.0.0.1:22 qr@free.pinggy.io > /dev/null 2>&1 &
        sleep 20
        echo "==========================="
        echo "    🐧 DUO VPS - Ubuntu RDP "
        echo " BY: 🐉 SHANGHAI & NULLTESTFUN1 ⚡"
        echo "==========================="
        echo " 🌐 HOST/IP : (xem log Pinggy ở trên phần kết nối)"
        echo " 👤 USER    : blender"
        echo " 🔑 PASS    : 123456Hi"
        echo " ⏱️ Max TIME: 6 Hour"
        echo "==========================="
        echo "✅ VPS Ready at $(date +%H:%M:%S)"
        echo ""

    - name: Keep Alive
      run: |
        while true; do
          RAND=$((1000 + RANDOM % 9000))
          echo "🔹 Alive ping :: $RAND"
          sleep 300
        done
