name: MacOS 26 Test

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-2022
    timeout-minutes: 360  # t·ªëi ƒëa 6h

    steps:
    - name: Enable RDP
      run: |
        Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        Get-Service -Name TermService | Set-Service -StartupType Automatic
        Start-Service -Name TermService

    - name: Create user "blender"
      run: |
        net user blender 123456Hi /add
        net localgroup administrators blender /add
        Write-Host "‚úÖ User 'blender' created with password '123456Hi'"

    - name: Optimize VPS
      run: |
        powercfg -duplicatescheme e9a42b02-d5df-448d-aa00-03f14749eb61
        powercfg -setactive e9a42b02-d5df-448d-aa00-03f14749eb61
        Stop-Service wuauserv; Set-Service wuauserv -StartupType Disabled
        Stop-Service Spooler; Set-Service Spooler -StartupType Disabled
        sc config DiagTrack start= disabled
        sc config SysMain start= disabled
        Write-Host "‚ö° Optimization applied."

    - name: Download Pinggy
      shell: powershell
      run: |
        Invoke-WebRequest https://github.com/pinggy-io/pinggy/releases/latest/download/pinggy-windows-amd64.exe -OutFile pinggy.exe

    - name: Start RDP Tunnel
      shell: powershell
      run: |
        Start-Process -NoNewWindow -FilePath .\pinggy.exe -ArgumentList "-R3389:127.0.0.1:3389","-p","443","qr@free.pinggy.io"
        Start-Sleep -Seconds 15
        $time = Get-Date -Format "HH:mm:ss"
        Write-Host ""
        Write-Host "==========================="
        Write-Host "    üíª DUO VPS - 6Hour ‚è≥   "
        Write-Host " BY: üêâ SHANGHAI & NULLTESTFUN1 ‚ö°"
        Write-Host "==========================="
        Write-Host " üåê HOST/IP : (xem log Pinggy ·ªü tr√™n)"
        Write-Host " üë§ USER    : blender"
        Write-Host " üîë PASS    : 123456Hi"
        Write-Host " ‚è±Ô∏è Max TIME: 6 Hour"
        Write-Host "==========================="
        Write-Host "‚úÖ Started at $time"
        Write-Host ""

    - name: Keep Alive & Anti-ban
      run: |
        echo "‚è≥ KeepAlive running..."
        while ($true) {
          $rand = Get-Random -Minimum 1000 -Maximum 9999
          Write-Host "üîπ Alive ping at $(Get-Date -Format 'HH:mm:ss') :: $rand"
          Start-Sleep -Seconds 300
        }
