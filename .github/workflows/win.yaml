name: Ubuntu 25.3.1 DEMO

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 360   # max 6h

    steps:
    - name: Setup system (fast)
      run: |
        sudo apt-get update -y

    - name: Create user blender
      run: |
        sudo useradd -m -s /bin/bash blender
        echo "blender:123456Hi" | sudo chpasswd
        sudo usermod -aG sudo blender

    - name: Install & enable SSH
      run: |
        sudo apt-get install -y openssh-server
        sudo systemctl enable ssh --now
        # enable password login
        sudo sed -i 's/^#PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo sed -i 's/^PasswordAuthentication.*/PasswordAuthentication yes/' /etc/ssh/sshd_config
        sudo systemctl restart ssh

    - name: Start SSH Tunnel via Pinggy
      shell: bash
      run: |
        echo "‚è≥ Starting Pinggy tunnel..."
        ssh -o StrictHostKeyChecking=no -p 443 -R0:127.0.0.1:22 qr@free.pinggy.io | tee pinggy.log &
        sleep 10
        SSH_ADDR=$(grep -m 1 "Forwarding TCP" pinggy.log | awk '{print $5}' | sed 's/tcp:\/\///')

        echo "==========================="
        echo "    üêß DUO VPS - Ubuntu SSH "
        echo " BY: üêâ SHANGHAI & NULLTESTFUN1 ‚ö°"
        echo "==========================="
        echo " üåê SSH HOST/IP : $SSH_ADDR"
        echo " üë§ USER        : blender"
        echo " üîë PASS        : 123456Hi"
        echo " ‚è±Ô∏è Max TIME    : 6 Hour"
        echo "==========================="
        echo "‚úÖ VPS Ready at $(date +%H:%M:%S)"

    - name: Keep Alive
      run: |
        while true; do
          RAND=$((1000 + RANDOM % 9000))
          echo "üîπ Alive ping :: $RAND"
          sleep 300
        done
